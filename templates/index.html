<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PSX – Port Scanner eXtreme</title>
  <style>
    body { background: #0d0d0d; color: #00ffff; font-family: monospace; padding: 2rem; }
    input, button { padding: 0.5rem; margin: 0.5rem; border: none; border-radius: 5px; }
    #threat-meter { width: 100%; background: #333; height: 20px; border-radius: 10px; margin-top: 1rem; }
    #threat-bar { height: 100%; border-radius: 10px; transition: 0.5s ease; width: 0%; }
    #timeline { margin-top: 2rem; }
    .modal, .popup { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); justify-content: center; align-items: center; z-index: 1000; }
    .modal-content, .popup-content { background: #111; padding: 2rem; border-radius: 10px; text-align: center; color: white; }
    .btn { background: #00ffff; color: #000; cursor: pointer; }
    .btn:hover { background: #00cccc; }
  </style>
</head>
<body>
  <h1>🔎 PSX – Port Scanner eXtreme</h1>
  <input type="text" id="target" placeholder="Target domain/IP" required>
  <input type="number" id="start" placeholder="Start Port" value="1">
  <input type="number" id="end" placeholder="End Port" value="100">
  <button class="btn" onclick="showPermissionModal()">Scan</button>

  <div id="permissionModal" class="modal">
    <div class="modal-content">
      <h2>Permission Required</h2>
      <p>Do you have permission to scan this domain/IP?</p>
      <button class="btn" onclick="confirmScan()">Yes, I Accept</button>
      <button class="btn" onclick="window.close()">No</button>
    </div>
  </div>

  <div id="educationPopup" class="popup">
    <div class="popup-content">
      <h2>📚 New to Port Scanning?</h2>
      <p>Learn about what port scanning is and how it works.</p>
      <button class="btn" onclick="redirectToLearn()">Learn More</button>
      <button class="btn" onclick="closePopup()">Dismiss</button>
    </div>
  </div>

  <div id="threat-meter">
    <div id="threat-bar"></div>
  </div>
  <div id="timeline"></div>

  <script>
    let popupTimeout = setTimeout(() => {
      document.getElementById('educationPopup').style.display = 'flex';
    }, 10000);

    function showPermissionModal() {
      clearTimeout(popupTimeout);
      document.getElementById('permissionModal').style.display = 'flex';
    }

    function confirmScan() {
      document.getElementById('permissionModal').style.display = 'none';
      startScan();
    }

    function startScan() {
      const target = document.getElementById('target').value;
      const start = document.getElementById('start').value;
      const end = document.getElementById('end').value;

      const timeline = document.getElementById('timeline');
      timeline.innerHTML = '🔍 Scanning...<br>';

      fetch('/scan', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ target, start, end })
      })
      .then(res => res.json())
      .then(data => {
        timeline.innerHTML = `
          🌐 IP: ${data.ip}<br>
          📦 Open Ports: ${data.open_ports.join(', ') || 'None'}<br>
          📍 Location: ${data.geo.city || 'Unknown'}, ${data.geo.country_name || 'N/A'}<br>
          🔎 WHOIS: ${data.whois.substring(0, 300)}...<br>
          ⚠️ Threat Level: <strong>${data.threat}</strong><br>
        `;

        const threatBar = document.getElementById('threat-bar');
        threatBar.style.width = data.threat === "High" ? "100%" : data.threat === "Medium" ? "60%" : "30%";
        threatBar.style.background = data.threat === "High" ? "red" : data.threat === "Medium" ? "orange" : "lime";
      })
      .catch(() => {
        timeline.innerHTML = '❌ Scan failed. Check your input or try again.';
      });
    }

    function closePopup() {
      document.getElementById('educationPopup').style.display = 'none';
    }

    function redirectToLearn() {
      window.location.href = "/learn";
    }
  </script>
</body>
</html>
