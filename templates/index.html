<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PSX – Port Scanner eXtreme</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background: #0d1117;
      color: #fff;
      font-family: 'Segoe UI', sans-serif;
      padding-bottom: 100px;
    }
    .rasengan {
      display: none;
      justify-content: center;
      align-items: center;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.9);
      z-index: 9999;
    }
    .threat-bar {
      height: 20px;
      border-radius: 10px;
      overflow: hidden;
      margin-top: 10px;
    }
    .timeline {
      font-size: 0.9rem;
    }
  </style>
</head>
<body>
  <div class="container mt-5">
    <h1 class="text-center text-info mb-4">🔍 PSX – Port Scanner eXtreme</h1>
    <form id="scanForm" class="text-center">
      <input type="text" class="form-control mb-2" name="target" placeholder="Enter domain or IP" required>
      <button type="submit" class="btn btn-primary">Start Scan</button>
    </form>

    <div id="results" class="mt-4" style="display:none;">
      <h4>📊 Threat Level: <span id="threat-level" class="badge bg-secondary"></span></h4>
      <div class="threat-bar bg-dark mt-2">
        <div id="threat-bar-fill" class="bg-success" style="width: 0%; height: 100%; transition: width 1s;"></div>
      </div>

      <h5 class="mt-4">🛠 Open Ports:</h5>
      <ul id="ports" class="list-group"></ul>

      <h5 class="mt-4">🌐 Geo IP Info:</h5>
      <pre id="geo"></pre>

      <h5>🧠 DNS Deception Check:</h5>
      <pre id="deception"></pre>

      <h5 class="mt-4">🕒 Scan Timeline:</h5>
      <ul id="timeline" class="timeline"></ul>
    </div>
  </div>

  <!-- Rasengan Loading -->
  <div class="rasengan" id="loadingScreen">
    <img src="https://media.tenor.com/p0G_bmA2N-oAAAAC/rasengan.gif" alt="Loading Rasengan" width="300">
  </div>

  <!-- Scan Permission Modal -->
  <div class="modal fade" id="permissionModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content text-dark">
        <div class="modal-header">
          <h5 class="modal-title">⚠️ Scan Permission</h5>
        </div>
        <div class="modal-body">
          Are you 16 or older and have permission to perform this scan?
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" onclick="window.close()">No</button>
          <button class="btn btn-success" data-bs-dismiss="modal">Yes</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const form = document.getElementById('scanForm');
    const loading = document.getElementById('loadingScreen');
    const results = document.getElementById('results');

    window.onload = () => {
      const modal = new bootstrap.Modal(document.getElementById('permissionModal'));
      modal.show();
    }

    form.addEventListener('submit', async e => {
      e.preventDefault();
      results.style.display = 'none';
      loading.style.display = 'flex';

      const formData = new FormData(form);
      const res = await fetch('/scan', { method: 'POST', body: formData });

      loading.style.display = 'none';

      if (!res.ok) {
        alert("Failed to scan. Check input.");
        return;
      }

      const data = await res.json();
      document.getElementById('threat-level').innerText = data.threat_level;

      let threatColor = "bg-success", width = "30%";
      if (data.threat_level === "Medium") {
        threatColor = "bg-warning"; width = "65%";
      } else if (data.threat_level === "High") {
        threatColor = "bg-danger"; width = "100%";
      }
      const bar = document.getElementById('threat-bar-fill');
      bar.className = threatColor;
      bar.style.width = width;

      const list = document.getElementById('ports');
      list.innerHTML = '';
      data.open_ports.forEach(p => {
        const li = document.createElement('li');
        li.className = 'list-group-item text-dark';
        li.innerText = `Port ${p.port} - ${p.description}`;
        list.appendChild(li);
      });

      const geo = data.geo_info;
      document.getElementById('geo').innerText = `IP: ${geo.ip}\nCity: ${geo.city}\nRegion: ${geo.region}\nCountry: ${geo.country}\nOrg: ${geo.org}`;

      document.getElementById('deception').innerText = data.deception.join('\n');

      const tlist = document.getElementById('timeline');
      tlist.innerHTML = '';
      data.timeline.forEach(t => {
        const item = document.createElement('li');
        item.innerText = `Open port detected at ${t}`;
        tlist.appendChild(item);
      });

      results.style.display = 'block';
    });
  </script>
</body>
</html>
